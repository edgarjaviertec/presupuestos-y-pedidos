var positiveDecimalRegex=/^\d*[.]?\d{0,2}$/,positiveIntegerRegex=/^\d*$/,IVA=16;function getAmountDue(t){return $.ajax({url:"/admin/orders/get_amount_due_ajax",type:"get",data:{id:t}}).promise()}function getTotalPaid(t,e){return $.ajax({url:"/admin/orders/get_total_paid_ajax",type:"get",data:{order_id:t,customer_id:e}}).promise()}function checkCurrentDiscountType(){var t=$("#discountType");"fixed"==(isEmpty(t.val())?"fixed":t.val())?(addInputFilterToFixedDiscount(),addChangeAndKeyupEventToDiscount()):(addInputFilterToPercentageDiscount(),addChangeAndKeyupEventToDiscount())}function addChangeAndKeyupEventToDiscount(){$("#discount").on("change keyup",(function(t){t.preventDefault(),updateSummary(),$(this).valid()}))}function addInputFilterToPercentageDiscount(){$("#discount").off(),$("#discount").inputFilter((function(t){return positiveIntegerRegex.test(t)&&(""===t||parseInt(t)<=100)}))}function addInputFilterToFixedDiscount(){$("#discount").off(),$("#discount").inputFilter((function(t){return positiveDecimalRegex.test(t)&&(""===t||parseFloat(t)<=1e6)}))}function addInputFilterToProductFields(){var t=$("input.item-qty"),e=$("input.item-unit-price");e.off(),e.inputFilter((function(t){return positiveDecimalRegex.test(t)&&(""===t||parseFloat(t)<=1e6)})),t.off(),t.inputFilter((function(t){return positiveDecimalRegex.test(t)&&(""===t||parseFloat(t)<=1e6)}))}function addNameAttribute(){$("#itemsTable").find("input.item-qty").each((function(t){$(this).removeAttr("name"),$(this).attr("name","items["+t+"][qty]")})),$("#itemsTable").find("input.item-name.tt-input").each((function(t){$(this).removeAttr("name"),$(this).attr("name","items["+t+"][name]")})),$("#itemsTable").find("input.product-id").each((function(t){$(this).removeAttr("name"),$(this).attr("name","items["+t+"][product_id]")})),$("#itemsTable").find("input.item-unit-price").each((function(t){$(this).removeAttr("name"),$(this).attr("name","items["+t+"][unit_price]")})),$("#itemsTable").find("textarea.item-description").each((function(t){$(this).removeAttr("name"),$(this).attr("name","items["+t+"][description]")})),$("#itemsTable").find("input.total-line-input").each((function(t){$(this).removeAttr("name"),$(this).attr("name","items["+t+"][total]")}))}function addValidationRules(){var t=$('input[name^="items"]');t.filter('input[name$="[qty]"]').each((function(){$(this).rules("add",{required:!0,greaterThanZero:!0,normalizer:function(t){return t=$.trim(t)},messages:{required:"Campo requerido"}})})),t.filter('input[name$="[unit_price]"]').each((function(){$(this).rules("add",{required:!0,greaterThanZero:!0,normalizer:function(t){return t=$.trim(t)},messages:{required:"Campo requerido"}})})),t.filter('input[name$="[name]"]').not(".tt-hint").each((function(){$(this).rules("add",{required:!0,normalizer:function(t){return $.trim(t)},messages:{required:"Campo requerido"}})}))}function updateLineTotal(t){var e=t.find(".item-qty"),a=t.find(".item-unit-price"),n=t.find(".total-line .formatted-number"),i=t.find(".total-line input.total-line-input"),o=0,r=e.val(),s=a.val();isEmpty(r)||isEmpty(s)||(o=parseFloat(r)*parseFloat(s)),i.val(o),n.text(formatNumber(o))}function updateTotalOfItems(){var t=$("#itemsTable").find(".table-body .table-row").length;$("#totalOfItems").val(t)}function updateSubtotal(){var t=$(".total-line-input"),e=$("#subTotal").closest(".amount").find(".formatted-number"),a=$("#subTotal"),n=0;t.each((function(){isEmpty($(this).val())||(n=parseFloat(n)+parseFloat($(this).val()))})),n=n.toFixed(2),n=parseFloat(n),a.val(n),e.text(formatNumber(n))}function updateDiscount(){var t,e=$("#discountValInput"),a=$("#discountValInput").closest(".amount").find(".formatted-number"),n=$("#discountType"),i=$("#subTotal"),o=$("#discount"),r=isEmpty(n.val())?"fixed":n.val().trim(),s=isEmpty(o.val())?0:parseFloat(o.val()),u=isEmpty(i.val())?0:parseFloat(i.val()),d=0;u>0?$("#discountTypeInputGroup").removeClass("d-none"):($("#discountTypeInputGroup").addClass("d-none"),$("#discount").val(0),$("#discount").valid()),u>0&&"fixed"===r?d=s:u>0&&"percentage"===r?(d=(d=u*s/100).toFixed(2),d=parseFloat(d)):d=0,e.val(d),t=formatNumber(d>0?-d:d),a.text(t),o.valid()}function updateTax(){var t=$("#subTotal"),e=$("#tax"),a=$("#discountValInput"),n=e.closest(".amount").find(".formatted-number"),i=isEmpty(t.val())?0:parseFloat(t.val()),o=isEmpty(a.val())?0:parseFloat(a.val()),r=0==o?i*IVA/100:(i-o)*IVA/100;r=(r=1===parseInt($("#includeTax").val())?r:0).toFixed(2),r=parseFloat(r),e.val(r),n.text(formatNumber(r))}function updateTotal(){var t=$("#subTotal"),e=$("#discountValInput"),a=$("#tax"),n=$("#total"),i=n.closest(".amount").find(".formatted-number"),o=(isEmpty(t.val())?0:parseFloat(t.val()))-(isEmpty(e.val())?0:parseFloat(e.val()))+(isEmpty(a.val())?0:parseFloat(a.val()));o=o.toFixed(2),o=parseFloat(o),n.val(o),i.text(formatNumber(o))}function updateAmountDue(){if($("#amountDue").length&&$("#totalPaid").length){var t=$("#total"),e=$("#totalPaid"),a=$("#amountDue"),n=a.closest(".amount").find(".formatted-number"),i=(isEmpty(t.val())?0:parseFloat(t.val()))-(isEmpty(e.val())?0:parseFloat(e.val()));i=i.toFixed(2),(i=parseFloat(i))<=0?$("#addNewPayment").attr("disabled",!0):$("#addNewPayment").attr("disabled",!1),a.val(i),n.text(formatNumber(i))}}function updateSummary(){updateSubtotal(),updateDiscount(),updateTax(),updateTotal(),updateAmountDue()}function addTypeaheadToProductName(){$("#itemsTable input.item-name").typeahead("destroy"),$("#itemsTable input.item-name").typeahead({highlight:!0},{source:new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("nombre"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"/admin/estimates/get_products_ajax?search=",remote:{url:"/admin/estimates/get_products_ajax?search=%QUERY",wildcard:"%QUERY"}}),limit:5,display:"nombre",templates:{suggestion:function(t){return'<span><i class="tt-item-icon fas fa-shopping-basket"></i>'+t.nombre+"</span>"}}}),$("#itemsTable input.item-name").on("typeahead:select",(function(t,e){var a=e.id,n=e.descripcion,i=e.precio_unitario,o=$(t.currentTarget).closest(".table-row").find("input.product-id"),r=$(t.currentTarget).closest(".table-row").find("textarea.item-description"),s=$(t.currentTarget).closest(".table-row").find("input.item-unit-price");o.val(a).trigger("change"),r.val(n).trigger("change"),s.val(i).trigger("change"),addAutosizeToProductDescription()})),$("#itemsTable input.item-name").on("typeahead:render typeahead:open",(function(t,e){$(".tt-suggestion").first().addClass("tt-cursor"),$(".tt-suggestion").length&&$(".empty-message").hide()}))}function addAutosizeToProductDescription(){autosize($(".item-description"))}function addDays(t,e){return t.setHours(0,0,0,0),t.setDate(t.getDate()+parseInt(e)),t}function dmyFormat(t){return`${(""+t.getDate()).padStart(2,"0")}/${(""+(t.getMonth()+1)).padStart(2,"0")}/${t.getFullYear()}`}function ymdFormat(t){var e=t.split("/"),a=e[0],n=e[1];return`${e[2]}-${n}-${a}`}function parseDmyDate(t){var e=t.split("/"),a=parseInt(e[0],10),n=parseInt(e[1],10)-1,i=parseInt(e[2],10);return new Date(i,n,a)}function isEmpty(t){var e,a,n,i=[void 0,null,!1,0,"","0"];for(a=0,n=i.length;a<n;a++)if(t===i[a])return!0;if("object"==typeof t){for(e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1}function formatNumber(t){return t.toLocaleString("en-US",{style:"currency",currency:"USD"})}function getPaymentsMade(){var t=0,e=$("#orderId"),a=$("#customerId"),n=isEmpty(e.val())?0:e.val(),i=isEmpty(a.val())?0:a.val(),o=[];return $("#paymentsContainer .payment").each((function(e){var a=$(this).find(".payment-date"),r=$(this).find(".payment-type"),s=$(this).find(".payment-notes"),u=$(this).find(".payment-amount"),d=isEmpty(a.val())?"":a.val(),l=isEmpty(r.val())?"":r.val(),m=isEmpty(s.val())?"":s.val(),p=isEmpty(u.val())?0:u.val();t=parseFloat(t)+parseFloat(p),o.push({date:d,type:l,notes:m,amount:p,order_id:n,customer_id:i})})),o}$(document).ready((function(){var t=new Pikaday({field:$("#datepicker")[0],firstDay:1,position:"bottom center",format:"D/M/YYYY",toString:(t,e)=>dmyFormat(t),parse:(t,e)=>parseDmyDate(t),onSelect(t){$("#dueDateDropdown").trigger("change"),$("#date").val(ymdFormat(dmyFormat(t)))},i18n:pikadaySpanishLanguage});function e(){addAutosizeToProductDescription(),addTypeaheadToProductName(),addInputFilterToProductFields(),addNameAttribute(),addValidationRules()}$("#dueDateDropdown").on("change",(function(e){e.preventDefault();var a=$(this).val(),n=dmyFormat(addDays(t.getDate(),a)),i=ymdFormat(n);$("#dueDateText").text(n),$("#dueDateInput").val(i)})),$("#customerSelect2").select2({dropdownParent:$("#customerSelect2").parent(),ajax:{url:"/admin/estimates/get_customers_ajax",delay:400,data:function(t){return{start:10*((t.page||1)-1),length:10,search:t.term}},processResults:function(t,e){return e.page=e.page||1,{results:t.data,pagination:{more:10*e.page<t.recordsFiltered}}},cache:!0},templateResult:function(t){return t.id?$('<span><i class="fas fa-user-tie select2-results__option__icon"></i>'+t.text+"</span>"):t.text}}),$("#addCustomerBtn").click((function(t){t.preventDefault(),$("#customerSelect2").select2("open")})),$("#customerSelect2").on("select2:select",(function(t){var e=t.params.data.id,a=t.params.data.text,n=t.params.data.telefono,i=t.params.data.telefono_celular,o=[],r=t.params.data.domicilio,s=t.params.data.ciudad,u=t.params.data.estado,d=t.params.data.pais,l=t.params.data.codigo_postal;n=""==n&&""!=i?i:n,""!=r&&o.push(r),""!=s&&o.push(s),""!=u&&o.push(u),""!=d&&o.push(d),""!=l&&o.push(l);var m="";o.forEach((function(t,e){e!=o.length?m+=t+" ":m+=t})),$("#customerId").val(e),$("#nameInput").text(a),$("#addressInput").text(m),$("#phoneInput").text(n),$("#customerInfo").removeClass("d-none"),$("#addCustomerBtn").addClass("d-none"),$("#customerId").valid()})),$("body").on("keypress","input",(function(t){13==t.keyCode&&t.preventDefault()})),$("#removeCustomerBtn").click((function(t){t.preventDefault(),$("#addCustomerBtn").removeClass("d-none"),$("#customerInfo").addClass("d-none"),$("#customerId").val("")})),$("body").on("click","#addNewCustomerBtn",(function(t){t.preventDefault(),alert("creando nuevo cliente")})),$("body").on("change keyup",".item-qty",(function(t){t.preventDefault(),updateLineTotal($(this).closest(".table-row")),updateSummary()})),$("body").on("change keyup",".item-unit-price",(function(t){t.preventDefault(),updateLineTotal($(this).closest(".table-row")),updateSummary()})),$("body").on("click",".remove-item-btn",(function(t){t.preventDefault(),$(this).closest(".table-row").remove(),updateTotalOfItems(),addNameAttribute(),updateSummary()})),$("#addItemBtn").click((function(t){t.preventDefault();var a=$("#itemsTable").find(".table-body"),n=$("#itemTemplate").html(),i=$("#totalOfItems");a.append(n),updateTotalOfItems(),e(),i.valid()})),$("body").on("click",".tt-menu .tt-dataset .tt-footer .add-new-btn",(function(t){t.preventDefault(),alert("creando nuevo producto")})),$("#documentForm").validate({ignore:"",rules:{customer_id:{required:!0,normalizer:function(t){return $.trim(t)}},total_items:{required:!0,greaterThanZero:!0,normalizer:function(t){return $.trim(t)}},discount:{required:!0,lessThanOrEqualToSubtotal:!0,normalizer:function(t){return t=$.trim(t)}}},messages:{total_items:{greaterThanZero:"Debes agregar al menos un producto"},customer_id:{required:"Debes selecionar un cliente"},discount:{required:"Campo requerido"}},errorElement:"div",errorPlacement:function(t,e){t.addClass("invalid-feedback"),"checkbox"===e.prop("type")?t.insertAfter(e.next("label")):e.parent().hasClass("input-group")?t.insertAfter(e.parent()):t.insertAfter(e)},highlight:function(t,e,a){"hidden"==$(t).prop("type")&&"customer"==$(t).data("type")?$(t).closest(".customer").find(".add-customer-btn").addClass("is-invalid"):"hidden"==$(t).prop("type")&&"items"==$(t).data("type")?$(t).closest(".add-item").find(".add-item-btn").addClass("is-invalid"):$(t).parent().hasClass("input-group")?$(t).closest(".input-group").addClass("is-invalid"):$(t).addClass("is-invalid")},unhighlight:function(t,e,a){"hidden"==$(t).prop("type")&&"customer"==$(t).data("type")?$(t).closest(".customer").find(".add-customer-btn").removeClass("is-invalid"):"hidden"==$(t).prop("type")&&"items"==$(t).data("type")?$(t).closest(".add-item").find(".add-item-btn").removeClass("is-invalid"):$(t).parent().hasClass("input-group")?$(t).closest(".input-group").removeClass("is-invalid"):$(t).removeClass("is-invalid")},submitHandler:function(t){var e=$("#amountDue");return(isEmpty(e.val())?0:parseFloat(e.val()))>=0?t.submit():swal.fire({customClass:{container:"modal-with-icon"},type:"error",title:"El total no puede ser menor que el monto pagado"}),!1}}),jQuery.validator.addMethod("lessThanOrEqualToSubtotal",(function(t,e){var a=$("#subTotal"),n=isEmpty(a.val())?0:parseFloat(a.val()),i=isEmpty(t)?0:parseFloat(t);return n>=0&&i<=n||0==n&&i>n}),"El descuento debe ser menor o igual al subtotal"),jQuery.validator.addMethod("greaterThanZero",(function(t,e){return this.optional(e)||parseFloat(t)>0}),"Debe ser mayor a 0"),checkCurrentDiscountType(),$("#discountTypeInputGroup").on("hide.bs.dropdown",(function(t){var e=$(t.clickEvent.target).data("icon"),a=$(t.clickEvent.target).data("type");if(void 0!==e&&void 0!==a){var n='<i class="'+e+'"></i>';$(t.relatedTarget).find(".icon").html(n),"fixed"==a?(addInputFilterToFixedDiscount(),addChangeAndKeyupEventToDiscount(),$("#discountType").val(a),$("#discount").val(0),updateSummary()):(addInputFilterToPercentageDiscount(),addChangeAndKeyupEventToDiscount(),$("#discountType").val(a),$("#discount").val(0),updateSummary())}})),autosize($(".notes textarea")),$("#taxCheckbox").click((function(){$(this).hasClass("checked")?($(this).removeClass("checked"),$("#includeTax").val(0),updateSummary()):($(this).addClass("checked"),$(this).val(1),$("#includeTax").val(1),updateSummary())})),e(),void 0!==$("#documentForm").data("flash-msg-type")&&void 0!==$("#documentForm").data("flash-msg-title")&&Swal.fire({customClass:{container:"flash-message flash-success"},position:"top-end",toast:!0,type:$("#documentForm").data("flash-msg-type"),title:$("#documentForm").data("flash-msg-title"),showConfirmButton:!1,timer:2e3})}));
//# sourceMappingURL=document.min.js.map